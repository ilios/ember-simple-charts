{"version":3,"file":"simple-chart-pack.js","sources":["../../src/components/simple-chart-pack.gjs"],"sourcesContent":["import Component from '@glimmer/component';\nimport 'd3-transition';\nimport { tracked } from '@glimmer/tracking';\n\nimport { select } from 'd3-selection';\nimport { hierarchy, pack } from 'd3-hierarchy';\nimport { interpolateSinebow } from 'd3-scale-chromatic';\nimport { scaleSequential } from 'd3-scale';\nimport { modifier } from 'ember-modifier';\n\nexport default class SimpleChartPack extends Component {\n  @tracked loading = true;\n\n  paint = modifier(\n    (\n      element,\n      [\n        data,\n        isIcon,\n        isClickable,\n        hover,\n        leave,\n        onClick,\n        containerHeight,\n        containerWidth,\n      ],\n    ) => {\n      if (!containerHeight || !containerWidth) {\n        return;\n      }\n      this.loading = true;\n      const height = Math.min(containerHeight, containerWidth) || 0;\n      const width = Math.min(containerHeight, containerWidth) || 0;\n      const dataOrEmptyObject = data ? data : {};\n      const svg = select(element);\n\n      const packLayout = pack()\n        .size([height - 15, width - 15])\n        .padding(10);\n      const rootNode = hierarchy(dataOrEmptyObject);\n      rootNode.sum((d) => d.value);\n      packLayout(rootNode);\n      const color = scaleSequential(interpolateSinebow).domain([\n        0,\n        rootNode.value,\n      ]);\n\n      svg.selectAll('.chart').remove();\n      const chart = svg.append('g').attr('class', 'chart');\n\n      const nodes = chart\n        .selectAll('circle')\n        .data(rootNode.descendants())\n        .enter()\n        .append('circle')\n        .classed('node', true)\n        .attr('fill', (d) => color(d.value))\n        .attr('cx', (d) => d.x)\n        .attr('cy', (d) => d.y)\n        .attr('r', (d) => d.r);\n\n      if (!isIcon) {\n        chart\n          .selectAll('circle')\n          .filter((d) => d.data.description)\n          .append('desc')\n          .text((d) => d.data.description);\n\n        nodes.on('mouseenter', ({ target }) => {\n          const { data } = select(target).datum();\n          const elements = chart.selectAll('circle.node');\n          const selectedElement = elements.filter(({ data: nodeData }) => {\n            return nodeData.name === data.name;\n          });\n          hover(data, selectedElement.node());\n        });\n        nodes.on('mouseleave', leave);\n\n        if (isClickable) {\n          nodes.on('click', ({ target }) => {\n            const { data } = select(target).datum();\n            onClick(data);\n          });\n          nodes.style('cursor', 'pointer');\n        }\n      }\n      this.loading = false;\n    },\n  );\n  <template>\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      class=\"simple-chart-pack{{if this.loading ' loading' ' loaded'}}\"\n      height={{@containerHeight}}\n      width={{@containerWidth}}\n      {{this.paint\n        @data\n        @isIcon\n        @isClickable\n        @hover\n        @leave\n        @onClick\n        @containerHeight\n        @containerWidth\n      }}\n      ...attributes\n    ></svg>\n  </template>\n}\n"],"names":["SimpleChartPack","Component","g","prototype","tracked","i","paint","modifier","element","data","isIcon","isClickable","hover","leave","onClick","containerHeight","containerWidth","loading","height","Math","min","width","dataOrEmptyObject","svg","select","packLayout","pack","size","padding","rootNode","hierarchy","sum","d","value","color","scaleSequential","interpolateSinebow","domain","selectAll","remove","chart","append","attr","nodes","descendants","enter","classed","x","y","r","filter","description","text","on","target","datum","elements","selectedElement","nodeData","name","node","style","setComponentTemplate","precompileTemplate","strictMode"],"mappings":"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"}