{"version":3,"file":"simple-chart-tree.js","sources":["../../src/components/simple-chart-tree.gjs"],"sourcesContent":["import Component from '@glimmer/component';\nimport { tracked } from '@glimmer/tracking';\nimport 'd3-transition';\n\nimport { select } from 'd3-selection';\nimport { hierarchy, tree } from 'd3-hierarchy';\nimport { interpolateSinebow } from 'd3-scale-chromatic';\nimport { scaleSequential } from 'd3-scale';\nimport { modifier } from 'ember-modifier';\n\nexport default class SimpleChartTree extends Component {\n  @tracked loading = true;\n\n  paint = modifier(\n    (\n      element,\n      [\n        data,\n        isIcon,\n        isClickable,\n        hover,\n        leave,\n        onClick,\n        containerHeight,\n        containerWidth,\n      ],\n    ) => {\n      if (!containerHeight || !containerWidth) {\n        return;\n      }\n      this.loading = true;\n      const height = Math.min(containerHeight, containerWidth) || 0;\n      const width = Math.min(containerHeight, containerWidth) || 0;\n      const dataOrEmptyObject = data ? data : {};\n      const svg = select(element);\n      const radius = Math.min(5, height / 50);\n\n      const treeLayout = tree().size([height - 15, width - 15]);\n      const root = hierarchy(dataOrEmptyObject);\n      treeLayout(root);\n      const color = scaleSequential(interpolateSinebow).domain([\n        0,\n        Math.max(root.height),\n      ]);\n\n      svg.selectAll('.chart').remove();\n      const chart = svg.append('g').attr('class', 'chart');\n      chart.attr('transform', `translate(${radius}, ${radius})`);\n      chart.append('g').classed('links', true);\n      chart.append('g').classed('nodes', true);\n\n      // Links\n      chart\n        .select('.links')\n        .selectAll('line.link')\n        .data(root.links())\n        .enter()\n        .append('line')\n        .classed('link', true)\n        .attr('stroke', (d) => color(d.source.depth))\n        .attr('stroke-width', '1px')\n        .attr('x1', (d) => d.source.x)\n        .attr('y1', (d) => d.source.y)\n        .attr('x2', (d) => d.target.x)\n        .attr('y2', (d) => d.target.y);\n\n      // Nodes\n      const nodes = chart\n        .select('.nodes')\n        .selectAll('circle.node')\n        .data(root.descendants())\n        .enter()\n        .append('circle')\n        .classed('node', true)\n        .attr('fill', (d) => color(d.depth))\n        .attr('cx', (d) => d.x)\n        .attr('cy', (d) => d.y)\n        .attr('r', radius);\n\n      if (!isIcon) {\n        chart\n          .select('.nodes')\n          .selectAll('circle.node')\n          .filter((d) => d.data.description)\n          .append('desc')\n          .text((d) => d.data.description);\n\n        nodes.on('mouseenter', ({ target }) => {\n          const { data } = select(target).datum();\n          const elements = svg.selectAll('circle.node');\n          const selectedElement = elements.filter(({ data: nodeData }) => {\n            return nodeData.name === data.name;\n          });\n          hover(data, selectedElement.node());\n        });\n        nodes.on('mouseleave', leave);\n\n        if (isClickable) {\n          nodes.on('click', ({ target }) => {\n            const { data } = select(target).datum();\n            onClick(data);\n          });\n          nodes.style('cursor', 'pointer');\n        }\n      }\n      this.loading = false;\n    },\n  );\n  <template>\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      class=\"simple-chart-tree {{if this.loading 'loading' 'loaded'}}\"\n      height={{@containerHeight}}\n      width={{@containerWidth}}\n      {{this.paint\n        @data\n        @isIcon\n        @isClickable\n        @hover\n        @leave\n        @onClick\n        @containerHeight\n        @containerWidth\n      }}\n      ...attributes\n    ></svg>\n  </template>\n}\n"],"names":["SimpleChartTree","Component","g","prototype","tracked","i","paint","modifier","element","data","isIcon","isClickable","hover","leave","onClick","containerHeight","containerWidth","loading","height","Math","min","width","dataOrEmptyObject","svg","select","radius","treeLayout","tree","size","root","hierarchy","color","scaleSequential","interpolateSinebow","domain","max","selectAll","remove","chart","append","attr","classed","links","enter","d","source","depth","x","y","target","nodes","descendants","filter","description","text","on","datum","elements","selectedElement","nodeData","name","node","style","setComponentTemplate","precompileTemplate","strictMode"],"mappings":"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"}