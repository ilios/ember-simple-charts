{"version":3,"file":"simple-chart-bar.js","sources":["../../src/components/simple-chart-bar.gjs"],"sourcesContent":["import Component from '@glimmer/component';\nimport { tracked } from '@glimmer/tracking';\nimport { select } from 'd3-selection';\nimport { scaleBand, scaleLinear, scaleSequential } from 'd3-scale';\nimport { interpolateSinebow } from 'd3-scale-chromatic';\nimport { modifier } from 'ember-modifier';\nimport sliceColor from '../utils/slice-color.js';\n\nexport default class SimpleChartBar extends Component {\n  @tracked loading = true;\n\n  get dataOrArray() {\n    return this.args.data ?? [{ data: 1, label: '', empty: true }];\n  }\n\n  paint = modifier(\n    (\n      element,\n      [data, isIcon, isClickable, hover, leave, onClick, textIsNotOutlined],\n    ) => {\n      this.loading = true;\n      const svg = select(element);\n      const values = data.map((d) => d.data);\n      const color = scaleSequential(interpolateSinebow).domain([\n        0,\n        Math.max(...values),\n      ]);\n\n      const yScale = scaleLinear()\n        .domain([0, Math.max(...data.map((d) => d.data))])\n        .range([0, isIcon ? 100 : 95]);\n\n      const xScale = scaleBand()\n        .domain(data.map((d) => d.label))\n        .range([0, isIcon ? 100 : 95])\n        .paddingInner(0.12);\n\n      svg.selectAll('.bars').remove();\n      const bars = svg.append('g').attr('class', 'bars');\n\n      const rect = bars\n        .selectAll('rect')\n        .data(data)\n        .enter()\n        .append('rect')\n        .attr('width', `${xScale.bandwidth()}%`)\n        .attr('height', (d) => `${yScale(d.data)}%`)\n        .attr('x', (d) => `${xScale(d.label)}%`)\n        .attr('y', (d) => `${100 - yScale(d.data)}%`)\n        .attr('fill', (d) => color(d.data));\n\n      if (!isIcon) {\n        const text = bars\n          .selectAll('text')\n          .data(data)\n          .enter()\n          .append('text')\n          .style('fill', (d) => sliceColor(d.data, color))\n          .style('font-size', '.8rem')\n          .attr('text-anchor', 'middle')\n          .attr('x', (d) => `${xScale(d.label) + xScale.bandwidth() / 2}%`)\n          .attr('y', (d) => `${110 - yScale(d.data)}%`)\n          .each(function () {\n            if (!textIsNotOutlined) {\n              select(this)\n                .append('tspan')\n                .attr('class', 'text-outline')\n                .attr('fill', (d) => sliceColor(d.data, color, true))\n                .attr('stroke', (d) => sliceColor(d.data, color, true))\n                .attr('stroke-width', '3px')\n                .attr('stroke-linejoin', 'round')\n                .text((d) => d.data)\n                .append('tspan')\n                .attr(\n                  'x',\n                  (d) => `${xScale(d.label) + xScale.bandwidth() / 2}%`,\n                )\n                .attr('y', (d) => `${110 - yScale(d.data)}%`)\n                .attr('dy', '0')\n                .text('\\u200b');\n            }\n\n            select(this).append((d) => document.createTextNode(d.data));\n          });\n\n        bars\n          .selectAll('rect')\n          .filter((d) => d.description)\n          .append('desc')\n          .text((d) => d.description);\n\n        const handleHover = ({ target }) => {\n          const { label, data, meta } = select(target).datum();\n          const rects = svg.selectAll('rect');\n          const selected = rects.filter((rectData) => rectData.data === data);\n          hover({ label, data, meta }, selected.node());\n        };\n        rect.on('mouseenter', handleHover);\n        text.on('mouseenter', handleHover);\n        rect.on('mouseleave', leave);\n        text.on('mouseleave', leave);\n\n        if (isClickable) {\n          rect.on('click', ({ target }) => {\n            const data = select(target).datum();\n            onClick(data);\n          });\n          rect.style('cursor', 'pointer');\n          text.on('click', ({ target }) => {\n            const data = select(target).datum();\n            onClick(data);\n          });\n          text.style('cursor', 'pointer');\n        }\n      }\n      this.loading = false;\n    },\n  );\n  <template>\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      class=\"simple-chart-bar{{if this.loading ' loading' ' loaded'}}\"\n      height={{@containerHeight}}\n      width={{@containerWidth}}\n      {{this.paint\n        this.dataOrArray\n        @isIcon\n        @isClickable\n        @hover\n        @leave\n        @onClick\n        @textIsNotOutlined\n      }}\n      ...attributes\n    ></svg>\n  </template>\n}\n"],"names":["SimpleChartBar","Component","g","prototype","tracked","i","dataOrArray","args","data","label","empty","paint","modifier","element","isIcon","isClickable","hover","leave","onClick","textIsNotOutlined","loading","svg","select","values","map","d","color","scaleSequential","interpolateSinebow","domain","Math","max","yScale","scaleLinear","range","xScale","scaleBand","paddingInner","selectAll","remove","bars","append","attr","rect","enter","bandwidth","text","style","sliceColor","each","document","createTextNode","filter","description","handleHover","target","meta","datum","rects","selected","rectData","node","on","setComponentTemplate","precompileTemplate","strictMode"],"mappings":"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"}