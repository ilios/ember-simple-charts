{"version":3,"file":"simple-chart-pie.js","sources":["../../src/components/simple-chart-pie.gjs"],"sourcesContent":["import Component from '@glimmer/component';\nimport { cached, tracked } from '@glimmer/tracking';\nimport 'd3-transition';\nimport { select } from 'd3-selection';\nimport { scaleSequential } from 'd3-scale';\nimport { interpolateSinebow } from 'd3-scale-chromatic';\nimport { arc, pie } from 'd3-shape';\nimport { easeLinear } from 'd3-ease';\nimport { interpolate } from 'd3-interpolate';\nimport { TrackedAsyncData } from 'ember-async-data';\nimport { modifier } from 'ember-modifier';\nimport sliceColor from '../utils/slice-color.js';\n\nexport default class SimpleChartPie extends Component {\n  @tracked loadingPromise;\n\n  @cached\n  get loadingData() {\n    return new TrackedAsyncData(this.loadingPromise);\n  }\n\n  get isLoading() {\n    if (this.args.isIcon) {\n      return false;\n    }\n\n    return !this.loadingPromise || this.loadingData.isPending;\n  }\n\n  get dataOrArray() {\n    return this.args.data ?? [{ data: 1, label: '', empty: true }];\n  }\n\n  paint = modifier(\n    (\n      element,\n      [\n        data,\n        isIcon,\n        isClickable,\n        hover,\n        leave,\n        onClick,\n        containerHeight,\n        containerWidth,\n        textIsNotOutlined,\n      ],\n    ) => {\n      if (!containerHeight || !containerWidth) {\n        return;\n      }\n      this.loadingPromise = null;\n      const height = Math.min(containerHeight, containerWidth) || 0;\n      const width = Math.min(containerHeight, containerWidth) || 0;\n      const svg = select(element);\n      const radius = Math.min(width, height) / 2;\n      const values = data.map((d) => d.data);\n      const color = scaleSequential(interpolateSinebow).domain([\n        0,\n        Math.max(...values),\n      ]);\n\n      const createArc = arc().innerRadius(0).outerRadius(radius);\n      const createPie = pie()\n        .value((d) => d.data)\n        .sort(null);\n      const createLabelArc = arc()\n        .outerRadius(radius - 32)\n        .innerRadius(radius - 32);\n\n      svg.selectAll('.chart').remove();\n      const chart = svg\n        .append('g')\n        .attr('class', 'chart')\n        //move the pie into the center of the chart\n        .attr('transform', 'translate(' + width / 2 + ',' + height / 2 + ')');\n      const path = chart\n        .selectAll('.slice')\n        .data(createPie(data))\n        .enter()\n        .append('g')\n        .attr('class', 'slice')\n        .append('path')\n        .attr('class', 'slicepath')\n        .attr('d', createArc)\n        .attr('stroke', '#FFFFFF')\n        .attr('fill', (d) => color(d.data.data));\n\n      if (!isIcon) {\n        this.loadingPromise = chart\n          .selectAll('path.slicepath')\n          .transition()\n          .ease(easeLinear)\n          .duration(500)\n          .attrTween('d', (b) => {\n            b.innerRadius = 0;\n            const i = interpolate({ startAngle: 0, endAngle: 0 }, b);\n            return (p) => createArc(i(p));\n          })\n          .end();\n\n        const text = chart\n          .selectAll('.slice')\n          .append('text')\n          .style('fill', (d) => sliceColor(d.data.data, color))\n          .style('font-size', '.8rem')\n          .attr(\n            'transform',\n            (d) => 'translate(' + createLabelArc.centroid(d) + ')',\n          )\n          .attr('text-anchor', 'middle')\n          .each(function () {\n            if (!textIsNotOutlined) {\n              select(this)\n                .append('tspan')\n                .attr('class', 'text-outline')\n                .attr('fill', (d) => sliceColor(d.data.data, color, true))\n                .attr('stroke', (d) => sliceColor(d.data.data, color, true))\n                .attr('stroke-width', '3px')\n                .attr('stroke-linejoin', 'round')\n                .text((d) => d.data.label)\n                .append('tspan')\n                .attr('x', '0')\n                .attr('dy', '0')\n                .text('\\u200b');\n            }\n\n            select(this).append((d) => document.createTextNode(d.data.label));\n          });\n\n        chart\n          .selectAll('.slice')\n          .filter((d) => d.data.description)\n          .append('desc')\n          .text((d) => d.data.description);\n\n        const handleHover = ({ target }) => {\n          const { data } = select(target).datum();\n          const slices = svg.selectAll('.slice');\n          const selectedSlice = slices.filter(\n            ({ data: sliceData }) => sliceData.label === data.label,\n          );\n          hover(data, selectedSlice.node());\n        };\n        path.on('mouseenter', handleHover);\n        text.on('mouseenter', handleHover);\n        path.on('mouseleave', leave);\n        text.on('mouseleave', leave);\n\n        if (isClickable) {\n          path.on('click', ({ target }) => {\n            const { data } = select(target).datum();\n            onClick(data);\n          });\n          path.style('cursor', 'pointer');\n          text.on('click', ({ target }) => {\n            const { data } = select(target).datum();\n            onClick(data);\n          });\n          text.style('cursor', 'pointer');\n        }\n      }\n    },\n  );\n  <template>\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      class=\"simple-chart-pie{{if this.isLoading ' loading' ' loaded'}}\"\n      height={{@containerHeight}}\n      width={{@containerWidth}}\n      {{this.paint\n        this.dataOrArray\n        @isIcon\n        @isClickable\n        @hover\n        @leave\n        @onClick\n        @containerHeight\n        @containerWidth\n        @textIsNotOutlined\n      }}\n      ...attributes\n    ></svg>\n  </template>\n}\n"],"names":["SimpleChartPie","Component","g","prototype","tracked","i","loadingData","TrackedAsyncData","loadingPromise","n","cached","isLoading","args","isIcon","isPending","dataOrArray","data","label","empty","paint","modifier","element","isClickable","hover","leave","onClick","containerHeight","containerWidth","textIsNotOutlined","height","Math","min","width","svg","select","radius","values","map","d","color","scaleSequential","interpolateSinebow","domain","max","createArc","arc","innerRadius","outerRadius","createPie","pie","value","sort","createLabelArc","selectAll","remove","chart","append","attr","path","enter","transition","ease","easeLinear","duration","attrTween","b","interpolate","startAngle","endAngle","p","end","text","style","sliceColor","centroid","each","document","createTextNode","filter","description","handleHover","target","datum","slices","selectedSlice","sliceData","node","on","setComponentTemplate","precompileTemplate","strictMode"],"mappings":";;;;;;;;;;;;;;;;AAae,MAAMA,cAAA,SAAuBC,SAAA,CAAA;AAAA,EAAA;IAAAC,CAAA,CAAA,IAAA,CAAAC,SAAA,EAAA,gBAAA,EAAA,CACzCC,OAAA,CAAA,CAAA;AAAA;EAAA,eAAA,IAAAC,CAAA,CAAA,IAAA,EAAA,gBAAA,CAAA,EAAA,MAAA;EAED,IACIC,WAAAA,GAAc;AAChB,IAAA,OAAO,IAAIC,gBAAA,CAAiB,IAAI,CAACC,cAAc,CAAA;AACjD,EAAA;AAAA,EAAA;IAAAC,CAAA,CAAA,IAAA,CAAAN,SAAA,EAAA,aAAA,EAAA,CAHCO,MAAA,CAAA,CAAA;AAAA;EAKD,IAAIC,SAAAA,GAAY;AACd,IAAA,IAAI,IAAI,CAACC,IAAI,CAACC,MAAM,EAAE;AACpB,MAAA,OAAO,KAAA;AACT,IAAA;IAEA,OAAO,CAAC,IAAI,CAACL,cAAc,IAAI,IAAI,CAACF,WAAW,CAACQ,SAAS;AAC3D,EAAA;EAEA,IAAIC,WAAAA,GAAc;AAChB,IAAA,OAAO,IAAI,CAACH,IAAI,CAACI,IAAI,IAAI,CAAC;AAAEA,MAAAA,IAAA,EAAM,CAAA;AAAGC,MAAAA,KAAA,EAAO,EAAA;AAAIC,MAAAA,KAAA,EAAO;AAAK,KAAA,CAAE;AAChE,EAAA;EAEAC,KAAA,GAAQC,QAAA,CACN,CACEC,OAAA,EACA,CACEL,IAAA,EACAH,MAAA,EACAS,WAAA,EACAC,KAAA,EACAC,KAAA,EACAC,OAAA,EACAC,eAAA,EACAC,cAAA,EACAC,iBAAA,CACD,KAAA;AAED,IAAA,IAAI,CAACF,eAAA,IAAmB,CAACC,cAAA,EAAgB;AACvC,MAAA;AACF,IAAA;IACA,IAAI,CAACnB,cAAc,GAAG,IAAA;IACtB,MAAMqB,MAAA,GAASC,IAAA,CAAKC,GAAG,CAACL,iBAAiBC,cAAA,CAAA,IAAmB,CAAA;IAC5D,MAAMK,KAAA,GAAQF,IAAA,CAAKC,GAAG,CAACL,iBAAiBC,cAAA,CAAA,IAAmB,CAAA;AAC3D,IAAA,MAAMM,MAAMC,MAAA,CAAOb,OAAA,CAAA;IACnB,MAAMc,MAAA,GAASL,IAAA,CAAKC,GAAG,CAACC,OAAOH,MAAA,CAAA,GAAU,CAAA;IACzC,MAAMO,SAASpB,IAAA,CAAKqB,GAAG,CAAEC,CAAA,IAAMA,EAAEtB,IAAI,CAAA;IACrC,MAAMuB,KAAA,GAAQC,eAAA,CAAgBC,kBAAA,CAAA,CAAoBC,MAAM,CAAC,CACvD,CAAA,EACAZ,IAAA,CAAKa,GAAG,CAAA,GAAIP,MAAA,CAAA,CACb,CAAA;AAED,IAAA,MAAMQ,YAAYC,GAAA,EAAA,CAAMC,WAAW,CAAC,CAAA,CAAA,CAAGC,WAAW,CAACZ,MAAA,CAAA;AACnD,IAAA,MAAMa,SAAA,GAAYC,GAAA,EAAA,CACfC,KAAK,CAAEZ,KAAMA,CAAA,CAAEtB,IAAI,CAAA,CACnBmC,IAAI,CAAC,IAAA,CAAA;AACR,IAAA,MAAMC,cAAA,GAAiBP,MACpBE,WAAW,CAACZ,SAAS,EAAA,CAAA,CACrBW,WAAW,CAACX,MAAA,GAAS,EAAA,CAAA;IAExBF,GAAA,CAAIoB,SAAS,CAAC,QAAA,CAAA,CAAUC,MAAM,EAAA;AAC9B,IAAA,MAAMC,KAAA,GAAQtB,IACXuB,MAAM,CAAC,KACPC,IAAI,CAAC,OAAA,EAAS,OAAA,CACf;AAAA,KACCA,IAAI,CAAC,WAAA,EAAa,YAAA,GAAezB,QAAQ,CAAA,GAAI,GAAA,GAAMH,SAAS,CAAA,GAAI,GAAA,CAAA;AACnE,IAAA,MAAM6B,OAAOH,KAAA,CACVF,SAAS,CAAC,QAAA,CAAA,CACVrC,IAAI,CAACgC,SAAA,CAAUhC,IAAA,CAAA,CAAA,CACf2C,KAAK,EAAA,CACLH,MAAM,CAAC,GAAA,CAAA,CACPC,IAAI,CAAC,OAAA,EAAS,OAAA,CAAA,CACdD,MAAM,CAAC,MAAA,CAAA,CACPC,IAAI,CAAC,SAAS,WAAA,CAAA,CACdA,IAAI,CAAC,GAAA,EAAKb,SAAA,CAAA,CACVa,IAAI,CAAC,QAAA,EAAU,WACfA,IAAI,CAAC,QAASnB,CAAA,IAAMC,MAAMD,CAAA,CAAEtB,IAAI,CAACA,IAAI,CAAA,CAAA;IAExC,IAAI,CAACH,MAAA,EAAQ;AACX,MAAA,IAAI,CAACL,cAAc,GAAG+C,MACnBF,SAAS,CAAC,kBACVO,UAAU,EAAA,CACVC,IAAI,CAACC,YACLC,QAAQ,CAAC,KACTC,SAAS,CAAC,KAAMC,CAAA,IAAA;QACfA,CAAA,CAAEnB,WAAW,GAAG,CAAA;QAChB,MAAMzC,IAAI6D,WAAA,CAAY;AAAEC,UAAAA,UAAA,EAAY,CAAA;AAAGC,UAAAA,QAAA,EAAU;SAAE,EAAGH,CAAA,CAAA;QACtD,OAAQI,CAAA,IAAMzB,SAAA,CAAUvC,CAAA,CAAEgE,CAAA,CAAA,CAAA;AAC5B,MAAA,CAAA,CAAA,CACCC,GAAG,EAAA;AAEN,MAAA,MAAMC,OAAOhB,KAAA,CACVF,SAAS,CAAC,QAAA,CAAA,CACVG,MAAM,CAAC,MAAA,CAAA,CACPgB,KAAK,CAAC,MAAA,EAASlC,CAAA,IAAMmC,UAAA,CAAWnC,EAAEtB,IAAI,CAACA,IAAI,EAAEuB,KAAA,CAAA,CAAA,CAC7CiC,KAAK,CAAC,aAAa,OAAA,CAAA,CACnBf,IAAI,CACH,WAAA,EACCnB,KAAM,YAAA,GAAec,cAAA,CAAesB,QAAQ,CAACpC,KAAK,GAAA,CAAA,CAEpDmB,IAAI,CAAC,aAAA,EAAe,QAAA,CAAA,CACpBkB,IAAI,CAAC,YAAA;QACJ,IAAI,CAAC/C,iBAAA,EAAmB;UACtBM,MAAA,CAAO,IAAI,CAAA,CACRsB,MAAM,CAAC,OAAA,CAAA,CACPC,IAAI,CAAC,OAAA,EAAS,cAAA,CAAA,CACdA,IAAI,CAAC,MAAA,EAASnB,CAAA,IAAMmC,UAAA,CAAWnC,CAAA,CAAEtB,IAAI,CAACA,IAAI,EAAEuB,KAAA,EAAO,IAAA,CAAA,CAAA,CACnDkB,IAAI,CAAC,QAAA,EAAWnB,CAAA,IAAMmC,UAAA,CAAWnC,CAAA,CAAEtB,IAAI,CAACA,IAAI,EAAEuB,KAAA,EAAO,IAAA,CAAA,CAAA,CACrDkB,IAAI,CAAC,cAAA,EAAgB,KAAA,CAAA,CACrBA,IAAI,CAAC,iBAAA,EAAmB,OAAA,CAAA,CACxBc,IAAI,CAAEjC,KAAMA,CAAA,CAAEtB,IAAI,CAACC,KAAK,CAAA,CACxBuC,MAAM,CAAC,OAAA,CAAA,CACPC,IAAI,CAAC,GAAA,EAAK,GAAA,CAAA,CACVA,IAAI,CAAC,IAAA,EAAM,GAAA,CAAA,CACXc,IAAI,CAAC,QAAA,CAAA;AACV,QAAA;AAEArC,QAAAA,MAAA,CAAO,IAAI,CAAA,CAAEsB,MAAM,CAAElB,CAAA,IAAMsC,QAAA,CAASC,cAAc,CAACvC,CAAA,CAAEtB,IAAI,CAACC,KAAK,CAAA,CAAA;AACjE,MAAA,CAAA,CAAA;AAEFsC,MAAAA,KAAA,CACGF,SAAS,CAAC,QAAA,CAAA,CACVyB,MAAM,CAAExC,CAAA,IAAMA,CAAA,CAAEtB,IAAI,CAAC+D,WAAW,EAChCvB,MAAM,CAAC,QACPe,IAAI,CAAEjC,CAAA,IAAMA,CAAA,CAAEtB,IAAI,CAAC+D,WAAW,CAAA;MAEjC,MAAMC,WAAA,GAAcA,CAAC;AAAEC,QAAAA;AAAM,OAAE,KAAA;QAC7B,MAAM;AAAEjE,UAAAA;SAAM,GAAGkB,MAAA,CAAO+C,QAAQC,KAAK,EAAA;AACrC,QAAA,MAAMC,MAAA,GAASlD,GAAA,CAAIoB,SAAS,CAAC,QAAA,CAAA;AAC7B,QAAA,MAAM+B,aAAA,GAAgBD,MAAA,CAAOL,MAAM,CACjC,CAAC;AAAE9D,UAAAA,IAAA,EAAMqE;SAAW,KAAKA,SAAA,CAAUpE,KAAK,KAAKD,KAAKC,KAAK,CAAA;QAEzDM,KAAA,CAAMP,IAAA,EAAMoE,cAAcE,IAAI,EAAA,CAAA;MAChC,CAAA;AACA5B,MAAAA,IAAA,CAAK6B,EAAE,CAAC,YAAA,EAAcP,WAAA,CAAA;AACtBT,MAAAA,IAAA,CAAKgB,EAAE,CAAC,YAAA,EAAcP,WAAA,CAAA;AACtBtB,MAAAA,IAAA,CAAK6B,EAAE,CAAC,YAAA,EAAc/D,KAAA,CAAA;AACtB+C,MAAAA,IAAA,CAAKgB,EAAE,CAAC,YAAA,EAAc/D,KAAA,CAAA;AAEtB,MAAA,IAAIF,WAAA,EAAa;AACfoC,QAAAA,IAAA,CAAK6B,EAAE,CAAC,OAAA,EAAS,CAAC;AAAEN,UAAAA;AAAM,SAAE,KAAA;UAC1B,MAAM;AAAEjE,YAAAA;WAAM,GAAGkB,MAAA,CAAO+C,QAAQC,KAAK,EAAA;UACrCzD,OAAA,CAAQT,IAAA,CAAA;AACV,QAAA,CAAA,CAAA;AACA0C,QAAAA,IAAA,CAAKc,KAAK,CAAC,QAAA,EAAU,SAAA,CAAA;AACrBD,QAAAA,IAAA,CAAKgB,EAAE,CAAC,OAAA,EAAS,CAAC;AAAEN,UAAAA;AAAM,SAAE,KAAA;UAC1B,MAAM;AAAEjE,YAAAA;WAAM,GAAGkB,MAAA,CAAO+C,QAAQC,KAAK,EAAA;UACrCzD,OAAA,CAAQT,IAAA,CAAA;AACV,QAAA,CAAA,CAAA;AACAuD,QAAAA,IAAA,CAAKC,KAAK,CAAC,QAAA,EAAU,SAAA,CAAA;AACvB,MAAA;AACF,IAAA;AACF,EAAA,CAAA,CAAA;AAEF,EAAA;IAAAgB,oBAAA,CAAAC,kBAAA,CAAA,+TAAA,EAmBA;MAAAC,UAAA,EAAA;KAAU,CAAA,EAAV,IAAW,CAAA;AAAD;AACZ;;;;"}